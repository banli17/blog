# 前端监控

前端监控主要是监控：

- 用户行为
- 性能监控
- 错误收集
- 上报

## domReady

domReady 实际是 DOM 加载完成，图片等链接资源正在加载中。onload 表示资源都已经加载完毕，如果有资源错误，则会阻塞延迟 onload 的执行。

**如何判断 domReady**

1. document.readyState 有三个状态：`loading/正在加载`、`interactive/可交互,图片、框架资源正在加载`、`complete/完成`。当这个属性值变化时，会触发`readystatechange`事件。
2. document 的 DOMContentLoaded 事件

## 简介

前端监控，可以让我们及时发现线上出现的问题，根据出现问题时的场景，更快的解决它。还可以搜集用户行为，从而为用户提供更好的体验。总的来说，有了线上的监控数据统计，我们才能在问题和需求上制定更好的方案。

## 监控哪些数据

监控数据主要是围绕着用户、性能和错误来展开。需要监控的数据有：

- 用户和用户行为
  - 流量来源 url(百度、google、广告等)、去向 url
  - 客户端信息(操作系统、浏览器、分辨率、ip、地域、网络类型等)
  - pv/uv、访问深度、访问路径、时间
  - 点击量（总的、人均）、点击热力图、点击时间
- 性能
  - 白屏时间
  - 首屏时间
  - 用户可操作时间
  - 页面总下载时间
  - 自定义的时间(开发者关注的)
- 错误
  - 错误的堆栈信息
  - 发生错误时的环境(浏览器信息、网络等)
- 其它自定义
  - 对特殊功能的支持程度(canvas)
  - 轮播图的翻页次数

## 用户和行为监控

### 用户行为路径

### 打点监控

一般监控 pv/uv 停留时长 流量来源 用户交互

监控访问的思路是：

手写埋点: 手动插入代码，灵活，但是工作量大。
无埋点：统计所有事件，定时上报，简单，但是后期需要过滤所需的数据。

### 大量 log 上报策略

有 2 个策略:

1. 前端根据配置文件，根据 random 抽取百分比上传
2. 全部上传给后端，后端忽略掉一些

### 时效策略
